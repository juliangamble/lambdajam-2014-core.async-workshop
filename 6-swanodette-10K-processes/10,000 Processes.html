<!DOCTYPE html>
<!-- saved from url=(0057)http://swannodette.github.io/2013/08/02/100000-processes/ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>10,000 Processes</title>
        <meta name="author" content="David Nolen">
        <link href="http://swannodette.github.com/atom.xml" rel="alternate" title="dosync" type="application/atom+xml">
        <!-- <link href="./10,000 Processes_files/css" rel="stylesheet" type="text/css"> -->
        <!--
        <link href="./assets/themes/tom/css" rel="stylesheet" type="text/css">
        -->

        <!-- syntax highlighting CSS -->
        <!-- <link rel="stylesheet" href="./10,000 Processes_files/syntax.css" type="text/css"> -->
        <link rel="stylesheet" href="./assets/themes/tom/css/syntax.css" type="text/css">

        <!-- Homepage CSS -->
        <!-- <link rel="stylesheet" href="./10,000 Processes_files/screen.css" type="text/css" media="screen, projection"> -->
        <link rel="stylesheet" href="./assets/themes/tom/css/screen.css" type="text/css" media="screen, projection">

        <!-- MathJax -->
<!--        <script async="" src="./10,000 Processes_files/analytics.js"></script><script type="text/x-mathjax-config;executed=true">
          MathJax.Hub.Config({
            tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ],
              processEscapes: true
            }
          });
        </script>
        <script type="text/javascript" src="./10,000 Processes_files/MathJax.js"></script>
    -->    
        <!-- Typekit -->
        <!--
        <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
        -->
    <style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Hover_Arrow {position: absolute; width: 15px; height: 11px; cursor: pointer}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_Menu_Close {position: absolute; width: 31px; height: 31px; top: -15px; left: -15px}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style></head>
    <body><div id="MathJax_Message" style="display: none;"></div>

        <div class="site">
            <div class="title">
                <a href="http://swannodette.github.io/">dosync</a>

                <a class="extra" href="http://swannodette.github.io/archive.html">Archive</a>
                <a class="extra" href="">Pages</a>
                <a class="extra" href="http://swannodette.github.io/categories.html">Categories</a>
                <a class="extra" href="http://swannodette.github.io/tags.html">Tags</a>
            </div>
            
            
<div id="post">
    <h1>10,000 Processes</h1>
    <p class="meta">
        02 August 2013 
        
    </p>
    <style>
table {
    margin-left: 45px;
    font-family: courier;
    font-size: 8px;
    line-height: 1em !important;
    margin-bottom: 50px;
}
.group0 {
    color: #000
}
.group1 {
    color: #f00
}
.group2 {
    color: #0f0
}
.group3 {
    color: #00f
}
.group4 {
    color: #ff0
}
.group5 {
    color: #0ff
}
</style>

<p><strong>UPDATE</strong>: I got too enthusiastic from the last post, this 10,000 not
100,000 go blocks.</p>

<p>10,000 independent go blocks all running at the same time.</p>



<table id="big-table" cellpadding="0" cellspacing="0">
</table>
<div class="highlight"><pre><code class="text language-text" data-lang="text">(ns blog.processes.core
  (:require [cljs.core.async :as async
             :refer [&lt;! &gt;! chan put! timeout]]
            [blog.utils.dom :refer [by-id set-html! set-class!]])
  (:require-macros [cljs.core.async.macros :refer [go]]))

(def width 100)
(def height 100)

(defn gen-ui []
  (let [arr (array)]
    (loop [y 0]
      (when (&lt; y height)
        (.push arr  "&lt;tr&gt;")
        (loop [x 0]
          (when (&lt; x width)
            (.push arr (str "&lt;td id='cell-") (+ x (* y width)) "'&gt;0&lt;/td&gt;")
            (recur (inc x))))
        (.push arr "&lt;/tr&gt;")
        (recur (inc y))))
    (set-html! (by-id "big-table") (.join arr ""))))

(gen-ui)

(def group (atom 0))

(defn render! [queue]
  (let [g (str "group" @group)]
    (doseq [[idx v] queue]
      (let [cell (by-id (str "cell-" idx))]
        (set-html! cell v)
        (set-class! cell g)))
    (swap! group (fn [g] (mod (inc g) 5)))))

(defn render-loop [rate]
  (let [in (chan 1000)]
    (go (loop [refresh (timeout rate) queue []]
          (let [[v c] (alts! [refresh in])]
            (condp = c
              refresh (do (render! queue)
                        (&lt;! (timeout 0))
                        (recur (timeout rate) []))
              in (recur refresh (conj queue v))))))
    in))

(let [render (render-loop 40)]
  (loop [i 0]
    (when (&lt; i (* width height))
      (go (while true
            (&lt;! (timeout (+ 1000 (rand-int 10000))))
            (&gt;! render [(rand-int 10000) (rand-int 10)])))
      (recur (inc i)))))
</code></pre></div>
<!-- <script type="text/javascript" src="./10,000 Processes_files/proc.js"></script> -->
<script type="text/javascript" src="./assets/js/goog/base.js"></script>
<script type="text/javascript" src="./assets/js/proc.js"></script>
<!-- <script type="text/javascript">goog.require("blog.processes.core");</script> -->


</div>
        

<!--
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42857620-1', 'swannodette.github.io');
  ga('send', 'pageview');

</script>
-->



    


</body></html>